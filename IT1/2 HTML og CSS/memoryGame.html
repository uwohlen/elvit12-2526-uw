<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    table,td,th {
      border: solid black 1px;
      /*border-collapse: collapse;*/
      padding: 5px;
    }
    .kortCL { /* div for kortet som skal flippes */
        position: relative; /* for å kunne bruke position absolute på front/bakside */
        width: 100px; /* Samme som bildene er, for div'en er uten innhold pga position absolute */
        height: 100px;
        transform-style: preserve-3d; /* for at fasit skal vises foran kryss når kortet snus */
        transition: transform 1s;
    }
    .flippCL { 
      transform: rotateY(180deg); /* flipp kort-divven */
    }
    .kryssCL, .fasitCL  {
      position: absolute; /* begge på samme sted, overlapper */
    }
    .fasitCL /* begynner med baksida fram - altså vises ikke */{ 
      transform: rotateY(180deg);
      backface-visibility: hidden; /* baksida vises ikke */
    }

  </style>
</head>
<body>
  <table>
    <tbody id="tabellID">
    </tbody>
  </table>
  <!--<p>Bildene er <span id="meldingID"></span></p>-->
  <script>
    let tabellEL = document.getElementById("tabellID");
    let meldingEL = document.getElementById("meldingID");
    let figurnavn = ["stjerne","sirkel","rombe","hjerte","pil","sekskant","trekant","firkant"]; 
    let fasit = [];
    let brukt = [];

    for (let i=0; i<figurnavn.length; i++) {
      brukt.push(0);
    }

    for (let i=0; i<figurnavn.length/2; i++) {
      fasit.push([])
      for (let j=0; j<figurnavn.length/2; j++) {
        let leter = true;
        while (leter) {
          let tilfeldig = Math.floor(Math.random()*figurnavn.length);
          if (brukt[tilfeldig] < 2) {
            fasit[i][j] = figurnavn[tilfeldig];
            brukt[tilfeldig] += 1;
            leter = false
          }
        }
      }
    }


    tekst = "";
    for (let i=0; i<fasit.length; i++) {
      tekst += "<tr>";
      for (let j=0; j<fasit[i].length; j++) {
        tekst += "<td><div data-bilde='"+fasit[i][j]+"' class='kortCL'>"
          tekst += "<img class='kryssCL' src='media/kryss.png'>";
          tekst += "<img class='fasitCL' src='media/"+fasit[i][j]+".png'>";
        tekst += "</div></td>"
      }
      tekst += "</tr>";
    }
    tabellEL.innerHTML += tekst;

    let alle = document.getElementsByClassName("kortCL");
    for (let kort of alle) {
      kort.addEventListener("click",sjekkFunk);
    }
    

    let kort1 = "";
    let kort2 = "";
    let vent = false;

    function sjekkFunk(event) {
      if (vent) {
        return;
      }
      //console.log(event.currentTarget) // elementet med addEventListener'n
      event.currentTarget.classList.add("flippCL");

      if (kort1 === "") {
        kort1 = event.currentTarget;
        kort1.removeEventListener("click",sjekkFunk);
        //meldingEL.innerHTML = ""
      } 
      else {
        vent = true;
        kort2 = event.currentTarget;
        kort2.removeEventListener("click",sjekkFunk);
        if (kort1.dataset.bilde === kort2.dataset.bilde) {
          //meldingEL.innerHTML = "LIKE";
          kort1 = "";
          kort2 = "";
          vent = false;
        }
        else {
          //meldingEL.innerHTML = "ULIKE";
          setTimeout(ventFunk,1000);
        }
      }
    }
    
    function ventFunk() {
      kort1.classList.remove("flippCL");
      kort2.classList.remove("flippCL");
      kort1.addEventListener("click",sjekkFunk);
      kort2.addEventListener("click",sjekkFunk);
      kort1 = "";
      kort2 = "";
      vent = false;
    }
  </script>
</body>
</html>